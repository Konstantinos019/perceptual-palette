<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Perceptual Palette</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@500;600&display=swap"
    rel="stylesheet">
  <link
    href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@600&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="./ui.css">
  <style>
    .icon-svg {
      width: 1em;
      height: 1em;
      fill: currentColor;
      vertical-align: middle;
      display: inline-block;
    }
  </style>
</head>

<body>
  <!-- INLINE SVG SPRITE (Material Symbols Rounded) -->
  <svg style="display: none;">
    <symbol id="icon-palette" viewBox="0 -960 960 960">
      <path
        d="M480-80q-82 0-155-31.5t-127.5-86Q143-252 111.5-325T80-480q0-83 32.5-156t88-127Q256-817 330-848.5T488-880q80 0 151 27.5t124.5 76q53.5 48.5 85 115T880-518q0 115-70 176.5T640-280h-74q-9 0-12.5 5t-3.5 11q0 12 15 34.5t15 51.5q0 50-27.5 74T480-80Zm0-400Zm-220 40q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120-160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm200 0q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm120 160q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17ZM480-160q9 0 14.5-5t5.5-13q0-14-15-33t-15-57q0-42 29-67t71-25h70q66 0 113-38.5T800-518q0-121-92.5-201.5T488-800q-136 0-232 93t-96 227q0 133 93.5 226.5T480-160Z" />
    </symbol>
    <symbol id="icon-refresh" viewBox="0 -960 960 960">
      <path
        d="M480-160q-134 0-227-93t-93-227q0-134 93-227t227-93q69 0 132 28.5T720-690v-70q0-17 11.5-28.5T760-800q17 0 28.5 11.5T800-760v200q0 17-11.5 28.5T760-520H560q-17 0-28.5-11.5T520-560q0-17 11.5-28.5T560-600h128q-32-56-87.5-88T480-720q-100 0-170 70t-70 170q0 100 70 170t170 70q68 0 124.5-34.5T692-367q8-14 22.5-19.5t29.5-.5q16 5 23 21t-1 30q-41 80-117 128t-169 48Z" />
    </symbol>
    <symbol id="icon-dark_mode" viewBox="0 -960 960 960">
      <path
        d="M480-120q-151 0-255.5-104.5T120-480q0-138 90-239.5T440-838q13-2 23 3.5t16 14.5q6 9 6.5 21t-7.5 23q-17 26-25.5 55t-8.5 61q0 90 63 153t153 63q31 0 61.5-9t54.5-25q11-7 22.5-6.5T819-479q10 5 15.5 15t3.5 24q-14 138-117.5 229T480-120Zm0-80q88 0 158-48.5T740-375q-20 5-40 8t-40 3q-123 0-209.5-86.5T364-660q0-20 3-40t8-40q-78 32-126.5 102T200-480q0 116 82 198t198 82Zm-10-270Z" />
    </symbol>
    <symbol id="icon-light_mode" viewBox="0 -960 960 960">
      <path
        d="M480-360q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35Zm0 80q-83 0-141.5-58.5T280-480q0-83 58.5-141.5T480-680q83 0 141.5 58.5T680-480q0 83-58.5 141.5T480-280ZM80-440q-17 0-28.5-11.5T40-480q0-17 11.5-28.5T80-520h80q17 0 28.5 11.5T200-480q0 17-11.5 28.5T160-440H80Zm720 0q-17 0-28.5-11.5T760-480q0-17 11.5-28.5T800-520h80q17 0 28.5 11.5T920-480q0 17-11.5 28.5T880-440h-80ZM480-760q-17 0-28.5-11.5T440-800v-80q0-17 11.5-28.5T480-920q17 0 28.5 11.5T520-880v80q0 17-11.5 28.5T480-760Zm0 720q-17 0-28.5-11.5T440-80v-80q0-17 11.5-28.5T480-200q17 0 28.5 11.5T520-160v80q0 17-11.5 28.5T480-40ZM226-678l-43-42q-12-11-11.5-28t11.5-29q12-12 29-12t28 12l42 43q11 12 11 28t-11 28q-11 12-27.5 11.5T226-678Zm494 495-42-43q-11-12-11-28.5t11-27.5q11-12 27.5-11.5T734-282l43 42q12 11 11.5 28T777-183q-12 12-29 12t-28-12Zm-42-495q-12-11-11.5-27.5T678-734l42-43q11-12 28-11.5t29 11.5q12 12 12 29t-12 28l-43 42q-12 11-28 11t-28-11ZM183-183q-12-12-12-29t12-28l43-42q12-11 28.5-11t27.5 11q12 11 11.5 27.5T282-226l-42 43q-11 12-28 11.5T183-183Zm297-297Z" />
    </symbol>
    <symbol id="icon-help" viewBox="0 -960 960 960">
      <path
        d="M478-240q21 0 35.5-14.5T528-290q0-21-14.5-35.5T478-340q-21 0-35.5 14.5T428-290q0 21 14.5 35.5T478-240Zm2 160q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Zm4-172q25 0 43.5 16t18.5 40q0 22-13.5 39T502-525q-23 20-40.5 44T444-427q0 14 10.5 23.5T479-394q15 0 25.5-10t13.5-25q4-21 18-37.5t30-31.5q23-22 39.5-48t16.5-58q0-51-41.5-83.5T484-720q-38 0-72.5 16T359-655q-7 12-4.5 25.5T368-609q14 8 29 5t25-17q11-15 27.5-23t34.5-8Z" />
    </symbol>
    <symbol id="icon-add" viewBox="0 -960 960 960">
      <path
        d="M440-440H240q-17 0-28.5-11.5T200-480q0-17 11.5-28.5T240-520h200v-200q0-17 11.5-28.5T480-760q17 0 28.5 11.5T520-720v200h200q17 0 28.5 11.5T760-480q0 17-11.5 28.5T720-440H520v200q0 17-11.5 28.5T480-200q-17 0-28.5-11.5T440-240v-200Z" />
    </symbol>
    <symbol id="icon-close" viewBox="0 -960 960 960">
      <path
        d="M480-424 284-228q-11 11-28 11t-28-11q-11-11-11-28t11-28l196-196-196-196q-11-11-11-28t11-28q11-11 28-11t28 11l196 196 196-196q11-11 28-11t28 11q11 11 11 28t-11 28L536-480l196 196q11 11 11 28t-11 28q-11 11-28 11t-28-11L480-424Z" />
    </symbol>
    <symbol id="icon-warning" viewBox="0 -960 960 960">
      <path
        d="M109-120q-11 0-20-5.5T75-140q-5-9-5.5-19.5T75-180l370-640q6-10 15.5-15t19.5-5q10 0 19.5 5t15.5 15l370 640q6 10 5.5 20.5T885-140q-5 9-14 14.5t-20 5.5H109Zm69-80h604L480-720 178-200Zm302-40q17 0 28.5-11.5T520-280q0-17-11.5-28.5T480-320q-17 0-28.5 11.5T440-280q0 17 11.5 28.5T480-240Zm0-120q17 0 28.5-11.5T520-400v-120q0-17-11.5-28.5T480-560q-17 0-28.5 11.5T440-520v120q0 17 11.5 28.5T480-360Zm0-100Z" />
    </symbol>
    <symbol id="icon-delete" viewBox="0 0 24 24">
      <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z" />
    </symbol>
    <symbol id="icon-save" viewBox="0 -960 960 960">
      <path
        d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h447q16 0 30.5 6t25.5 17l114 114q11 11 17 25.5t6 30.5v447q0 33-23.5 56.5T760-120H200Zm560-526L646-760H200v560h560v-446ZM480-240q50 0 85-35t35-85q0-50-35-85t-85-35q-50 0-85 35t-35 85q0 50 35 85t85 35ZM280-560h280q17 0 28.5-11.5T600-600v-80q0-17-11.5-28.5T560-720H280q-17 0-28.5 11.5T240-680v80q0 17 11.5 28.5T280-560Zm-80-86v446-560 114Z" />
    </symbol>
    <symbol id="icon-check_circle" viewBox="0 0 24 24">
      <path
        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm4.59-12.42L10 14.17l-2.59-2.58L6 13l4 4 8-8z" />
    </symbol>
    <symbol id="icon-check_circle_filled" viewBox="0 0 24 24">
      <path
        d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
    </symbol>
  </svg>


  <div class="plugin-container">
    <!-- SETTINGS CARD (Top) -->
    <div class="params-card section-card" id="settings-card" style="flex-shrink: 0;">
      <!-- GLOBAL HEADER -->
      <div class="top-header">
        <div class="flex-row" style="flex: 1 0 0; gap: 6px; align-items: center;">
          <div class="plugin-icon-box-small"
            style="background: transparent; border: none; padding: 0; width: 32px; height: 32px; overflow: hidden; display: flex; align-items: center; justify-content: center;">
            <img src="./logo.png" alt="Logo" style="width: 32px; height: 32px; display: block;">
          </div>
          <span class="brand-title-text">Perceptual Palette</span>
        </div>

        <!-- Header Controls -->
        <div class="header-controls">
          <button id="reset-plugin" class="icon-btn header-btn" title="Reset Plugin">
            <svg class="icon-svg">
              <use href="#icon-refresh"></use>
            </svg>
          </button>
          <div id="theme-toggle" class="smart-switch" title="Toggle Theme">
            <div id="theme-thumb" class="smart-switch__thumb">
              <svg id="theme-icon-dark" class="icon-svg">
                <use href="#icon-dark_mode"></use>
              </svg>
              <svg id="theme-icon-light" class="icon-svg" style="display:none">
                <use href="#icon-light_mode"></use>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Generation Mode Row -->
      <div class="color-tool">
        <div class="color-tool__header">
          <div class="tooltip-wrapper">
            <span class="color-tool__label">Generation mode</span>
            <svg id="gen-mode-help" class="icon-svg"
              style="font-size: 14px; color: var(--text-tertiary); cursor: help;">
              <use href="#icon-help"></use>
            </svg>
          </div>
        </div>
        <div class="color-tool__body">
          <div class="mode-tabs">
            <div id="mode-thumb" class="mode-thumb"></div>
            <button id="mode-legacy" class="mode-tab">Legacy</button>
            <button id="mode-oklch" class="mode-tab active">Perceptual</button>
          </div>
        </div>
      </div>

      <!-- Anchor Color Component -->
      <div class="color-tool" id="tool-anchor">
        <div class="color-tool__header">
          <span class="color-tool__label">Anchor color</span>
        </div>
        <div class="color-tool__body">
          <div class="value-badge">
            <input type="text" id="base-color-input" value="#9600FF" spellcheck="false" class="badge-input">
          </div>
          <div class="color-picker__trigger" id="anchor-gradient-pill">
            <input type="color" id="base-color-picker" class="color-picker__native" value="#9600FF">
            <div id="color-preview-bg" style="width:100%; height:100%; background: #9600FF; pointer-events: none;">
            </div>
          </div>
        </div>
      </div>

      <!-- Anchor Contrast Theme Toggle -->
      <div class="color-tool" id="tool-anchor-theme">
        <div class="color-tool__header">
          <span class="color-tool__label">Anchor contrast</span>
        </div>
        <div class="color-tool__body">
          <div id="anchor-theme-toggle" class="smart-switch" title="Toggle Anchor Background">
            <div id="anchor-theme-thumb" class="smart-switch__thumb">
              <svg id="anchor-icon-dark" class="icon-svg" style="font-size: 14px;">
                <use href="#icon-dark_mode"></use>
              </svg>
              <svg id="anchor-icon-light" class="icon-svg" style="font-size: 14px; display:none;">
                <use href="#icon-light_mode"></use>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- OKLCH Controls (Toggled) -->
      <!-- Note: We wrap these in a fragment-like container that doesn't add padding to keep rows direct siblings -->
      <div id="oklch-controls" style="display: contents;">
        <!-- Hue Component -->
        <div class="color-tool" id="tool-hue">
          <div class="color-tool__header">
            <span class="color-tool__label">Hue</span>
          </div>
          <div class="color-tool__body">
            <div class="value-badge">
              <span id="oklch-hue-value">320°</span>
            </div>
            <div class="slider-wrapper hue-slider-wrapper">
              <input type="range" id="oklch-hue-slider" min="0" max="360" step="1" value="320">
            </div>
          </div>
        </div>

        <!-- Vividness Component -->
        <div class="color-tool" id="tool-vividness">
          <div class="color-tool__header">
            <span class="color-tool__label">Vividness</span>
          </div>
          <div class="color-tool__body">
            <div class="value-badge">
              <span id="oklch-vividness-value">100%</span>
            </div>
            <div class="slider-wrapper vivid-slider-wrapper">
              <input type="range" id="oklch-vividness-slider" min="0" max="100" step="1" value="100">
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- MAIN CONTENT AREA (Sidebar + Editor) -->
    <div class="main-content-row">
      <!-- PALETTE SIDEBAR -->
      <div class="palette-sidebar" id="palette-sidebar">
        <div class="palette-pills" id="palette-pills">
          <!-- Dynamically populated by ui.ts -->
        </div>
        <button class="palette-pill palette-pill--add" id="add-palette-btn" title="Create New Palette">
          <svg class="icon-svg" style="font-size: 18px;">
            <use href="#icon-add"></use>
          </svg>
        </button>
      </div>

      <!-- RESULTS / PALETTE TABLE -->
      <div id="results-area" class="palette-container section-card">
        <div class="list-header">
          <!-- ui.ts injects header cells here -->
        </div>
        <div class="palette-list" id="stops-container">
          <!-- ui.ts injects rows here -->
        </div>
      </div>
    </div>

    <!-- FOOTER SECTION (Now a card inside the flow) -->
    <footer class="section-card plugin-footer">
      <div class="footer-row flex-between">
        <span class="label-sm"
          style="margin:0; font-size:12px; color: var(--text-primary); text-transform:none;">Generate
          tokens</span>
        <div id="create-tokens-toggle" class="smart-switch">
          <div class="smart-switch__thumb">
            <svg width="10" height="8" viewBox="0 0 10 8" fill="none" xmlns="http://www.w3.org/2000/svg"
              class="thumb-icon-svg">
              <path d="M1 4L3.5 6.5L9 1" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </div>
        </div>
      </div>

      <div class="footer-row">
        <button id="export-btn" class="btn btn--primary w-full">
          <svg class="icon-svg btn-icon">
            <use href="#icon-palette"></use>
          </svg>
          <span id="btn-text">Generate Palette</span>
        </button>
      </div>

      <div class="footer-info">
        <div class="version-text">V 0.0.82</div>
      </div>
  </div>

  </div>

  <!-- Resize Handle -->
  <div class="resizer-handle">
    <svg width="10" height="10" viewBox="0 0 10 10" fill="none" xmlns="http://www.w3.org/2000/svg">
      <path d="M8 8H9V9H8V8Z" fill="#888888" />
      <path d="M5 8H6V9H5V8Z" fill="#888888" />
      <path d="M8 5H9V6H8V5Z" fill="#888888" />
    </svg>
  </div>
  </div>

  </div>

  <!-- REFINE MODAL -->
  <div id="refine-modal" class="modal-overlay hidden"
    style="position: fixed; inset: 0; z-index: 100; display: flex; align-items: center; justify-content: center;">
    <div class="modal-card">
      <div class="modal-header">
        <span id="modal-stop-title" class="modal-title">Refine stop 500</span>
        <button id="close-modal" class="modal-close-btn"><svg class="icon-svg">
            <use href="#icon-close"></use>
          </svg></button>
      </div>

      <div class="control-section" style="overflow-y: auto; flex: 1;">
        <div style="padding: 24px; border-bottom: 1px solid #ececec; position: relative;">
          <div class="comparison-preview" style="display: flex; height: 128px;">
            <div id="preview-before">
              <span id="hex-before-label">#000000</span>
              <span class="swatch-sublabel">Original</span>
            </div>
            <div id="preview-after">
              <span id="hex-after-label">#000000</span>
              <span class="swatch-sublabel">Refining</span>
            </div>
          </div>
          <!-- Contrast Badge (V 0.0.80 Parity) -->
          <div class="contrast-badge" id="modal-contrast-badge" style="display: none;">
            <span id="modal-contrast-value">1.00</span>
            <svg class="icon-svg warning-icon" style="font-size: 16px;">
              <use href="#icon-warning"></use>
            </svg>
          </div>
        </div>

        <div style="padding: 16px 24px 0 24px;">
          <div class="mode-tabs" style="max-width: 100%; width: 100%;">
            <div id="segment-thumb" class="mode-thumb" style="width: calc(33.33% - 4px);"></div>
            <button class="mode-tab active" data-mode="hsl" style="width: 33.33%;">HSL</button>
            <button class="mode-tab" data-mode="hsb" style="width: 33.33%;">HSB</button>
            <button class="mode-tab" data-mode="rgb" style="width: 33.33%;">RGB</button>
          </div>
        </div>

        <!-- LCH Controls (Hidden) -->
        <div id="lch-controls" class="mode-content">
          <div class="modal-row">
            <div class="modal-row-label">
              <span class="label-text">Hue</span>
              <div id="hue-val" class="value-pill">0°</div>
            </div>
            <input type="range" id="hue-slider" class="rainbow-slider refiner-slider" min="0" max="360" step="1"
              style="width: 100%;">
          </div>
          <div class="modal-row">
            <div class="modal-row-label">
              <span class="label-text">Chroma</span>
              <div id="chroma-val" class="value-pill">0</div>
            </div>
            <input type="range" id="chroma-slider" class="refiner-slider" min="0" max="150" step="0.5"
              style="width: 100%;">
          </div>
          <div class="modal-row" style="border-bottom: none;">
            <div class="modal-row-label">
              <span class="label-text">Lightness</span>
              <div id="lch-l-val" class="value-pill">0</div>
            </div>
            <input type="range" id="lch-l-slider" class="refiner-slider" min="0" max="100" step="0.5"
              style="width: 100%;">
          </div>
        </div>

        <!-- HSL Controls (Default Active) -->
        <div id="hsl-controls" class="mode-content active">
          <div class="modal-row">
            <div class="modal-row-label">
              <span class="label-text">Hue</span>
              <div id="hsl-h-val" class="value-pill">0°</div>
            </div>
            <input type="range" id="hsl-h-slider" class="rainbow-slider refiner-slider" min="0" max="360" step="1"
              style="width: 100%;">
          </div>
          <div class="modal-row">
            <div class="modal-row-label">
              <span class="label-text">Saturation</span>
              <div id="hsl-s-val" class="value-pill">0%</div>
            </div>
            <input type="range" id="hsl-s-slider" class="refiner-slider" min="0" max="100" step="1"
              style="width: 100%;">
          </div>
          <div class="modal-row" style="border-bottom: none;">
            <div class="modal-row-label">
              <span class="label-text">Lightness</span>
              <div id="hsl-l-val" class="value-pill">0%</div>
            </div>
            <input type="range" id="hsl-l-slider" class="refiner-slider" min="0" max="100" step="1"
              style="width: 100%;">
          </div>
        </div>

        <!-- HSB Controls -->
        <div id="hsb-controls" class="mode-content">
          <div class="modal-row">
            <div class="modal-row-label">
              <span class="label-text">Hue</span>
              <div id="hsb-h-val" class="value-pill">0°</div>
            </div>
            <input type="range" id="hsb-h-slider" class="rainbow-slider refiner-slider" min="0" max="360" step="1"
              style="width: 100%;">
          </div>
          <div class="modal-row">
            <div class="modal-row-label">
              <span class="label-text">Saturation</span>
              <div id="hsb-s-val" class="value-pill">0%</div>
            </div>
            <input type="range" id="hsb-s-slider" class="refiner-slider" min="0" max="100" step="1"
              style="width: 100%;">
          </div>
          <div class="modal-row" style="border-bottom: none;">
            <div class="modal-row-label">
              <span class="label-text">Brightness</span>
              <div id="hsb-b-val" class="value-pill">0%</div>
            </div>
            <input type="range" id="hsb-b-slider" class="refiner-slider" min="0" max="100" step="1"
              style="width: 100%;">
          </div>
        </div>

        <!-- RGB Controls -->
        <div id="rgb-controls" class="mode-content">
          <div class="modal-row">
            <div class="modal-row-label">
              <span class="label-text">Red</span>
              <div id="rgb-r-val" class="value-pill">0</div>
            </div>
            <input type="range" id="rgb-r-slider" class="refiner-slider" min="0" max="255" step="1"
              style="width: 100%;">
          </div>
          <div class="modal-row">
            <div class="modal-row-label">
              <span class="label-text">Green</span>
              <div id="rgb-g-val" class="value-pill">0</div>
            </div>
            <input type="range" id="rgb-g-slider" class="refiner-slider" min="0" max="255" step="1"
              style="width: 100%;">
          </div>
          <div class="modal-row" style="border-bottom: none;">
            <div class="modal-row-label">
              <span class="label-text">Blue</span>
              <div id="rgb-b-val" class="value-pill">0</div>
            </div>
            <input type="range" id="rgb-b-slider" class="refiner-slider" min="0" max="255" step="1"
              style="width: 100%;">
          </div>
        </div>




        <div class="modal-footer">
          <button id="reset-override" class="btn-pill btn-pill-secondary">
            <svg class="icon-svg" style="font-size: 20px;">
              <use href="#icon-refresh"></use>
            </svg>
            Reset
          </button>
          <button id="save-modal-btn" class="btn-pill btn-pill-primary">
            <svg class="icon-svg" style="font-size: 20px;">
              <use href="#icon-save"></use>
            </svg>
            Save changes
          </button>
        </div>
      </div>
    </div>

    <!-- Global Tooltip for escaping overflow constraints - V 0.0.70 -->
    <div id="global-tooltip" class="tooltip-content" style="display: none;">
      <strong>Legacy</strong>: Uses the 100-900 scale based on Zain Adeel’s WCAG 2.1 algorithm for standard
      accessibility.<br><br>
      <strong>Perceptual (OKLCH)</strong>: Uses the latest APCA-aligned standard. We applied Zain's logic to the OKLCH
      L-axis for a more uniform and predictable visual scale.<br><br>
      <a href="https://uxdesign.cc/my-struggle-with-colors-part-ii-ed71bff6302a" target="_blank">Read Zain's Article</a>
    </div>

    <script type="module" src="./ui.ts"></script>
</body>

</html>